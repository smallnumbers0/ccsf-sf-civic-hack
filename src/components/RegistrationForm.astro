---
// Replace with your Google Apps Script Web App URL
const SHEET_URL = "https://script.google.com/macros/s/AKfycby-JndzHMNTyd57CeDRr8xEoGHVyuwkM1Q9Hl13oqcSv0EaUo5jx3yD_ZqiXnynbJyW/exec";
---

<div class="registration-form">
	<form id="hackathon-registration" class="form-container">
		<div class="form-group">
			<label for="name">Full Name</label>
			<input type="text" id="name" name="name" required>
		</div>

		<div class="form-group">
			<label for="email">Email Address</label>
			<input type="email" id="email" name="email" required>
		</div>

		<div class="form-group">
			<label for="affiliation">Affiliation</label>
			<select id="affiliation" name="affiliation" required>
				<option value="">Select your affiliation</option>
				<option value="ccsf_student">CCSF Student</option>
				<option value="act_member">ACT Member</option>
				<option value="professional">Tech Professional</option>
				<option value="other">Other</option>
			</select>
		</div>

		<div class="form-group">
			<label for="experience">Experience Level</label>
			<select id="experience" name="experience" required>
				<option value="">Select your experience level</option>
				<option value="beginner">Beginner</option>
				<option value="intermediate">Intermediate</option>
				<option value="advanced">Advanced</option>
			</select>
		</div>

		<div class="form-group">
			<label for="dietary">Dietary Restrictions</label>
			<input type="text" id="dietary" name="dietary" placeholder="Optional">
		</div>

		<button type="submit" class="submit-button">
			<span class="button-text">Submit Registration</span>
			<div class="spinner" style="display: none;"></div>
		</button>

		<div id="form-status" class="form-status" style="display: none;"></div>
	</form>
</div>

<style>
	.registration-form {
		max-width: 600px;
		margin: 0 auto;
		padding: 2rem;
		background: var(--card-background);
		border-radius: 8px;
		border: 1px solid rgba(168, 85, 247, 0.2);
	}

	.form-container {
		display: flex;
		flex-direction: column;
		gap: 1.5rem;
	}

	.form-group {
		display: flex;
		flex-direction: column;
		gap: 0.5rem;
	}

	label {
		color: var(--text-color);
		font-size: 0.9rem;
		font-family: 'Fira Code', monospace;
	}

	input, select {
		padding: 0.75rem;
		border-radius: 4px;
		border: 1px solid rgba(168, 85, 247, 0.3);
		background: rgba(30, 41, 59, 0.8);
		color: var(--text-color);
		font-family: 'Inter', sans-serif;
		transition: all 0.3s ease;
	}

	input:focus, select:focus {
		outline: none;
		border-color: var(--primary-color);
		box-shadow: 0 0 0 2px rgba(168, 85, 247, 0.2);
	}

	.checkbox-label {
		display: flex;
		align-items: center;
		gap: 0.5rem;
		cursor: pointer;
	}

	input[type="checkbox"] {
		width: 1.2rem;
		height: 1.2rem;
		cursor: pointer;
	}

	.submit-button {
		background: var(--primary-color);
		color: white;
		border: none;
		padding: 1rem;
		border-radius: 4px;
		font-family: 'Fira Code', monospace;
		cursor: pointer;
		transition: all 0.3s ease;
		position: relative;
		overflow: hidden;
	}

	.submit-button:hover {
		background: var(--secondary-color);
		transform: translateY(-2px);
		box-shadow: 0 0 20px rgba(168, 85, 247, 0.3);
	}

	.submit-button::after {
		content: '';
		position: absolute;
		top: -50%;
		left: -50%;
		width: 200%;
		height: 200%;
		background: linear-gradient(
			45deg,
			transparent,
			rgba(255, 255, 255, 0.1),
			transparent
		);
		transform: rotate(45deg);
		transition: 0.5s;
	}

	.submit-button:hover::after {
		transform: rotate(45deg) translate(100%, 100%);
	}

	.form-status {
		text-align: center;
		padding: 1rem;
		border-radius: 4px;
		margin-top: 1rem;
	}

	.form-status.success {
		background: rgba(34, 197, 94, 0.1);
		color: #22c55e;
	}

	.form-status.error {
		background: rgba(239, 68, 68, 0.1);
		color: #ef4444;
	}

	.spinner {
		width: 20px;
		height: 20px;
		border: 2px solid transparent;
		border-top-color: white;
		border-radius: 50%;
		animation: spin 1s linear infinite;
		position: absolute;
		right: 1rem;
		top: 50%;
		transform: translateY(-50%);
	}

	@keyframes spin {
		to {
			transform: translateY(-50%) rotate(360deg);
		}
	}

	.submit-button {
		position: relative;
	}

	.submit-button:disabled {
		opacity: 0.7;
		cursor: not-allowed;
	}
</style>

<script define:vars={{ SHEET_URL }}>
	const form = document.getElementById('hackathon-registration');
	const formStatus = document.getElementById('form-status');
	const submitButton = form?.querySelector('.submit-button');
	const spinner = form?.querySelector('.spinner');

	if (form instanceof HTMLFormElement && 
		formStatus && 
		submitButton instanceof HTMLButtonElement && 
		spinner instanceof HTMLElement) {
		
		form.addEventListener('submit', async (e) => {
			e.preventDefault();
			
			try {
				submitButton.disabled = true;
				spinner.style.display = 'block';
				formStatus.style.display = 'none';
				const formData = new FormData(form);
				const data = Object.fromEntries(formData.entries());

				const response = await fetch(SHEET_URL, {
					method: 'POST',
					mode: 'cors',
					headers: {
						'Content-Type': 'application/json'
					},
					body: JSON.stringify(data)
				});

				const result = await response.json();

				if (result.status !== 'success') {
					throw new Error(result.message || 'Submission failed');
				}

				formStatus.textContent = 'Registration submitted successfully! We will contact you soon.';
				formStatus.className = 'form-status success';
				formStatus.style.display = 'block';
				form.reset();
				
				setTimeout(() => {
					formStatus.style.display = 'none';
				}, 5000);
			} catch (error) {
				console.error('Error:', error);
				formStatus.textContent = 'Error submitting form. Please try again.';
				formStatus.className = 'form-status error';
				formStatus.style.display = 'block';
			} finally {
				submitButton.disabled = false;
				spinner.style.display = 'none';
			}
		});
	}
</script> 