---
// Replace this URL with the one from your Google Apps Script deployment
const SHEET_URL = "https://script.google.com/macros/s/AKfycbzDa9WNmq82IQ_as69ZS-pZ0XyzQYpV9CfZuFhxDFnI7t9vIskWV7vkeuRsRq40eJ3s/exec";
---

<div class="registration-form">
	<form id="hackathon-registration" class="form-container" target="hidden_iframe">
		<div class="form-group">
			<label for="name">Full Name</label>
			<input type="text" id="name" name="name" required>
		</div>

		<div class="form-group">
			<label for="email">Email Address</label>
			<input type="email" id="email" name="email" required>
		</div>

		<div class="form-group">
			<label for="affiliation">Affiliation</label>
			<select id="affiliation" name="affiliation" required>
				<option value="">Select your affiliation</option>
				<option value="ccsf_student">CCSF Student</option>
				<option value="act_member">ACT Member</option>
				<option value="professional">Tech Professional</option>
				<option value="other">Other</option>
			</select>
		</div>

		<div class="form-group">
			<label for="experience">Experience Level</label>
			<select id="experience" name="experience" required>
				<option value="">Select your experience level</option>
				<option value="beginner">Beginner</option>
				<option value="intermediate">Intermediate</option>
				<option value="advanced">Advanced</option>
			</select>
		</div>

		<div class="form-group">
			<label for="dietary">Dietary Restrictions</label>
			<input type="text" id="dietary" name="dietary" placeholder="Optional">
		</div>

		<button type="submit" class="submit-button">
			<span class="button-text">Submit Registration</span>
			<div class="spinner" style="display: none;"></div>
		</button>

		<div id="form-status" class="form-status" style="display: none;"></div>
	</form>
</div>

<iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"></iframe>

<script define:vars={{ SHEET_URL }}>
	const form = document.getElementById('hackathon-registration');
	const formStatus = document.getElementById('form-status');
	const submitButton = form?.querySelector('.submit-button');
	const spinner = form?.querySelector('.spinner');
	const buttonText = form?.querySelector('.button-text');
	const iframe = document.getElementById('hidden_iframe');

	if (form instanceof HTMLFormElement && 
		formStatus && 
		submitButton instanceof HTMLButtonElement && 
		spinner instanceof HTMLElement &&
		buttonText instanceof HTMLElement &&
		iframe) {

		// Set form action
		form.action = SHEET_URL;
		form.method = 'POST';
		
		// Handle form submission feedback
		iframe.addEventListener('load', () => {
			try {
				const iframeContent = iframe.contentDocument || iframe.contentWindow?.document;
				if (iframeContent) {
					const response = JSON.parse(iframeContent.body.textContent || '{}');
					
					if (response.status === 'success') {
						formStatus.textContent = 'Registration submitted successfully! We will contact you soon.';
						formStatus.className = 'form-status success';
						form.reset();
					} else {
						formStatus.textContent = response.message || 'An error occurred. Please try again.';
						formStatus.className = 'form-status error';
					}
				}
			} catch (error) {
				formStatus.textContent = 'An error occurred. Please try again.';
				formStatus.className = 'form-status error';
			}

			submitButton.disabled = false;
			spinner.style.display = 'none';
			buttonText.style.display = 'inline';
			formStatus.style.display = 'block';
			
			setTimeout(() => {
				if (formStatus.classList.contains('success')) {
					formStatus.style.display = 'none';
				}
			}, 5000);
		});

		form.addEventListener('submit', () => {
			submitButton.disabled = true;
			spinner.style.display = 'block';
			buttonText.style.display = 'none';
			formStatus.style.display = 'none';
		});
	}
</script>

<style>
	.registration-form {
		max-width: 600px;
		margin: 0 auto;
		padding: 2rem;
		background: var(--card-background);
		border-radius: 8px;
		border: 1px solid rgba(168, 85, 247, 0.2);
	}

	.form-container {
		display: flex;
		flex-direction: column;
		gap: 1.5rem;
	}

	.form-group {
		display: flex;
		flex-direction: column;
		gap: 0.5rem;
	}

	label {
		color: var(--text-color);
		font-size: 0.9rem;
		font-family: 'Fira Code', monospace;
	}

	input, select {
		padding: 0.75rem;
		border-radius: 4px;
		border: 1px solid rgba(168, 85, 247, 0.3);
		background: rgba(30, 41, 59, 0.8);
		color: var(--text-color);
		font-family: 'Inter', sans-serif;
		transition: all 0.3s ease;
	}

	input:focus, select:focus {
		outline: none;
		border-color: var(--primary-color);
		box-shadow: 0 0 0 2px rgba(168, 85, 247, 0.2);
	}

	.checkbox-label {
		display: flex;
		align-items: center;
		gap: 0.5rem;
		cursor: pointer;
	}

	input[type="checkbox"] {
		width: 1.2rem;
		height: 1.2rem;
		cursor: pointer;
	}

	.submit-button {
		background: var(--primary-color);
		color: white;
		border: none;
		padding: 1rem;
		border-radius: 4px;
		font-family: 'Fira Code', monospace;
		cursor: pointer;
		transition: all 0.3s ease;
		position: relative;
		overflow: hidden;
	}

	.submit-button:hover {
		background: var(--secondary-color);
		transform: translateY(-2px);
		box-shadow: 0 0 20px rgba(168, 85, 247, 0.3);
	}

	.submit-button::after {
		content: '';
		position: absolute;
		top: -50%;
		left: -50%;
		width: 200%;
		height: 200%;
		background: linear-gradient(
			45deg,
			transparent,
			rgba(255, 255, 255, 0.1),
			transparent
		);
		transform: rotate(45deg);
		transition: 0.5s;
	}

	.submit-button:hover::after {
		transform: rotate(45deg) translate(100%, 100%);
	}

	.form-status {
		text-align: center;
		padding: 1rem;
		border-radius: 4px;
		margin-top: 1rem;
	}

	.form-status.success {
		background: rgba(34, 197, 94, 0.1);
		color: #22c55e;
		border: 1px solid rgba(34, 197, 94, 0.2);
	}

	.form-status.error {
		background: rgba(239, 68, 68, 0.1);
		color: #ef4444;
		border: 1px solid rgba(239, 68, 68, 0.2);
	}

	.spinner {
		width: 20px;
		height: 20px;
		border: 2px solid transparent;
		border-top-color: white;
		border-radius: 50%;
		animation: spin 1s linear infinite;
		position: absolute;
		right: 1rem;
		top: 50%;
		transform: translateY(-50%);
	}

	@keyframes spin {
		to {
			transform: translateY(-50%) rotate(360deg);
		}
	}

	.submit-button {
		position: relative;
	}

	.submit-button:disabled {
		opacity: 0.7;
		cursor: not-allowed;
		transform: none;
	}
</style> 